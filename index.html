<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI虛擬口紅試色</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff0f6;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    color: #ff4d6d;
    margin-top: 20px;
  }
  #photo-container {
    position: relative;
    margin: 20px 0;
  }
  #user-photo {
    max-width: 300px;
    border-radius: 10px;
  }
  #lip-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
  #color-palette {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    overflow-x: auto;
    padding: 10px;
  }
  .color-swatch {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #fff;
    flex-shrink: 0;
  }
  .recommended {
    border: 3px solid #ff4d6d;
  }
  input[type=file] {
    margin-bottom: 20px;
  }
</style>
</head>
<body>

<h1>AI虛擬口紅試色</h1>
<input type="file" id="photo-input" accept="image/*">
<div id="photo-container">
  <img id="user-photo" src="" alt="你的照片">
  <canvas id="lip-overlay"></canvas>
</div>
<div id="color-palette">
  <div class="color-swatch" style="background:#FF4D6D" data-color="#FF4D6D"></div>
  <div class="color-swatch" style="background:#FF7F9C" data-color="#FF7F9C"></div>
  <div class="color-swatch" style="background:#FF6F91" data-color="#FF6F91"></div>
  <div class="color-swatch" style="background:#FF8C69" data-color="#FF8C69"></div>
  <div class="color-swatch" style="background:#FF5E78" data-color="#FF5E78"></div>
</div>

<script>
const photoInput = document.getElementById('photo-input');
const userPhoto = document.getElementById('user-photo');
const lipCanvas = document.getElementById('lip-overlay');
const ctx = lipCanvas.getContext('2d');
const swatches = document.querySelectorAll('.color-swatch');

photoInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    userPhoto.src = reader.result;
    userPhoto.onload = () => {
      lipCanvas.width = userPhoto.width;
      lipCanvas.height = userPhoto.height;
      ctx.clearRect(0,0,lipCanvas.width, lipCanvas.height);
      analyzeSkinColor();
    }
  };
  reader.readAsDataURL(file);
});

swatches.forEach(swatch => {
  swatch.addEventListener('click', () => {
    const color = swatch.dataset.color;
    drawLipOverlay(color);
  });
});

function drawLipOverlay(color) {
  if (!userPhoto.src) return;
  ctx.clearRect(0,0,lipCanvas.width, lipCanvas.height);
  ctx.fillStyle = color;
  ctx.globalAlpha = 0.5;
  const w = lipCanvas.width;
  const h = lipCanvas.height;
  ctx.beginPath();
  ctx.moveTo(w*0.3, h*0.7);
  ctx.bezierCurveTo(w*0.4, h*0.6, w*0.6, h*0.6, w*0.7, h*0.7);
  ctx.bezierCurveTo(w*0.6, h*0.8, w*0.4, h*0.8, w*0.3, h*0.7);
  ctx.fill();
}

function analyzeSkinColor() {
  const canvas = document.createElement('canvas');
  const context = canvas.getContext('2d');
  canvas.width = userPhoto.width;
  canvas.height = userPhoto.height;
  context.drawImage(userPhoto, 0, 0);
  const imgData = context.getImageData(0, 0, canvas.width, canvas.height);
  let r=0,g=0,b=0,count=0;

  // 取中間區域做膚色分析
  for(let y = canvas.height*0.3; y < canvas.height*0.7; y+=5){
    for(let x = canvas.width*0.3; x < canvas.width*0.7; x+=5){
      const i = (y*canvas.width + x)*4;
      r += imgData.data[i];
      g += imgData.data[i+1];
      b += imgData.data[i+2];
      count++;
    }
  }
  r = Math.floor(r/count);
  g = Math.floor(g/count);
  b = Math.floor(b/count);

  // 判斷冷暖色
  let skinTone = '';
  if(r>g && r> b) skinTone = 'warm';
  else if(b>r && b>g) skinTone = 'cool';
  else skinTone = 'neutral';

  recommendColors(skinTone);
}

function recommendColors(tone){
  swatches.forEach(swatch => swatch.classList.remove('recommended'));
  if(tone === 'warm') {
    // 橘調/珊瑚色
    swatches[3].classList.add('recommended');
    swatches[4].classList.add('recommended');
  } else if(tone === 'cool') {
    // 藍調紅/莓果
    swatches[0].classList.add('recommended');
    swatches[2].classList.add('recommended');
  } else {
    // 中性色 → 全部推薦
    swatches.forEach(s => s.classList.add('recommended'));
  }
}
</script>

</body>
</html>